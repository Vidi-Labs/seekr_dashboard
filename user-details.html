<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Count and User Details</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        h3 {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div>
        <h1>User Details</h1>
        <p><strong>ID:</strong> <span id="userId">N/A</span></p>
        <p><strong>Name:</strong> <span id="userName">N/A</span></p>
        <p><strong>Email:</strong> <span id="userEmail">N/A</span></p>
        <p><strong>Phone Number:</strong> <span id="userPhoneNumber">N/A</span></p>
        <p><strong>Anonymous:</strong> <span id="userIsAnonymous">N/A</span></p>
    </div>

    <div>
        <h3>Feature Count</h3>
        <p id="totalFeatures">Total Features: 0</p>
        <table>
            <thead>
                <tr>
                    <th>Feature Name</th>
                    <th>Created At</th>
                </tr>
            </thead>
            <tbody id="featureTableBody"></tbody>
        </table>
    </div>

    <script>
        // Function to fetch and display user details
        function fetchUserDetails(userId) {
            const apiUrl = `https://seekr-analytics.squadhead.workers.dev/analytics/users/${userId}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const user = data.data.user;

                        document.getElementById('userId').textContent = user.uid ?? '';
                        document.getElementById('userName').textContent = user.name ?? 'N/A';
                        document.getElementById('userEmail').textContent = user.email ?? 'N/A';
                        document.getElementById('userPhoneNumber').textContent = user.phoneNumber ?? 'N/A';
                        document.getElementById('userIsAnonymous').textContent = user.isAnonymous ? 'Yes' : 'No';
                    } else {
                        console.error('Failed to fetch user details:', data);
                    }
                })
                .catch(error => console.error('Error fetching user details:', error));
        }

        // Function to fetch and display feature counts
        function fetchFeatureCounts(userId) {
            const apiUrl = `https://seekr-analytics.squadhead.workers.dev/analytics/users/${userId}/features`;
            
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const featuresData = data.data.features;
                    const totalFeatures = data.data.total;

                    // Display total count
                    document.getElementById('totalFeatures').textContent = `Total Features: ${totalFeatures}`;

                    // Display features in a table
                    const tableBody = document.getElementById('featureTableBody');
                    tableBody.innerHTML = ''; // Clear existing data

                    featuresData.forEach(feature => {
                        const row = document.createElement('tr');
                        const featureNameCell = document.createElement('td');
                        featureNameCell.textContent = feature.feature;

                        const createdAtCell = document.createElement('td');
                        createdAtCell.textContent = new Date(feature.createdAt).toLocaleString();

                        row.appendChild(featureNameCell);
                        row.appendChild(createdAtCell);
                        tableBody.appendChild(row);
                    });
                } else {
                    console.error('Failed to fetch feature counts:', data);
                }
            })
            .catch(error => console.error('Error fetching feature counts:', error));
        }

        // On page load
        document.addEventListener('DOMContentLoaded', () => {
            const userId = '0fc31udQGSRqbRj1wzPtpvokQCL2'; // Replace with dynamic user ID as needed

            // Fetch and display user details
            fetchUserDetails(userId);

            // Fetch and display feature counts
            fetchFeatureCounts(userId);
        });
    </script>
</body>
</html>
